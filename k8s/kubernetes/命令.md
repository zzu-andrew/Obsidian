
## `kubectl`





### `kubectl get`

- 获取 `ConfigMap`类型对象的配置，并按照 `yaml` 形式输出
根据输出的 `mode: ipvs` 可以确定使用的网络负载均衡模式是 `iptables` 还是 `ipvs`
```bash
$ kubectl get configmap kube-proxy -n kube-system -o yaml
```

- 获取一个节点所有的 `yaml` 配置
```bash
$ $kubectl get pod prometheus-k8s-0 -n base-services -o yaml
```
- 获取对应空间中有多少service类型
可以用来查看service类型节点的cluster-ip和端口映射关系。
```bash
$ kubectl get service -n base-services
NAME                    TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)         AGE
prometheus-k8s          NodePort    10.96.0.184   <none>        9090:30090/TCP  8d
```
- 在获取到service类型之后可以通过一下命令查看对应service的yaml配置
这里的 `prometheus-k8s` 是service name
```bash
$ kubectl get service prometheus-k8s -n base-services -o yaml
apiVersion: v1
kind: Service
metadata:
  name: prometheus-k8s
  namespace: base-services
spec:
  clusterIP: 10.96.0.184
  clusterIPs:
  - 10.96.0.184
  externalTrafficPolicy: Cluster
  internalTrafficPolicy: Cluster
  - name: web
    nodePort: 30090
    port: 9090
    protocol: TCP
    targetPort: 9090
  selector:
    app: prometheus
    app.kubernetes.io/component: prometheus
    app.kubernetes.io/name: prometheus
    app.kubernetes.io/part-of: kube-prometheus
    prometheus: k8s
  # 会话亲和性，配置了亲和性同一个外部ClientIp在超时之前一直会访问同一个Pod
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800
  type: NodePort
```
- 获取所有监听类型的Pod资源
```bash
$ kubectl get all -n base-services
```


### `kubectl describe` 输出节点的详细信息

- 输出命名空间位`base-services`节点类型为`statefulset`类型节点的详细信息
```bash
$ kubectl describe statefulset prometheus-k8s -n base-services
```




### `kubectl` 其他命令

- 将pod的端口转发到宿主机
```bash
$ kubectl port-forward -n monitoring service/grafana 3000:80
```















